# docker build -t wolweb .
FROM golang:buster AS builder

LABEL org.label-schema.vcs-url="https://github.com/mordredp/wololo" \
      org.label-schema.url="https://github.com/mordredp/wololo/blob/master/README.md"

RUN mkdir /wolweb
WORKDIR /wolweb

# Install Dependecies
RUN git clone https://github.com/mordredp/wololo . && \
    go get -d github.com/gorilla/handlers && \
    go get -d github.com/gorilla/mux && \
    go get -d github.com/ilyakaznacheev/cleanenv

# Build Source Files
RUN go build -o wolweb . 

# Create 2nd Stage final image
FROM debian
WORKDIR /wolweb
COPY --from=builder /wololo/index.html .
COPY --from=builder /wololo/wolweb .
COPY --from=builder /wololo/devices.json .
COPY --from=builder /wololo/config.json .
COPY --from=builder /wololo/static ./static

ARG WOLWEBPORT=8089

CMD ["/wololo/wololo"]

EXPOSE ${WOLOLOPORT}
